<ng-container *ngIf="editor.stateChange$ | async"></ng-container>
<div [tuiFocusable]="focusable" (focus)="onTopFocus()"></div>
<div [tuiFocusable]="focusable" (focus)="onBottomFocus()"></div>
<section
    *ngIf="texts$ | async as texts"
    tuiToolbarNavigationManager
    class="wrapper"
>
    <div *ngIf="enabled(TuiEditorTool.Undo)" class="t-block">
        <button
            #button
            #undoBtn
            tuiToolbarTool
            tuiIconButton
            type="button"
            size="s"
            icon="tuiIconUndoLarge"
            class="t-tool t-tool_margin"
            appearance="icon"
            tuiHintDirection="top-left"
            [tuiHint]="texts.undo"
            [tuiHintId]="undoBtn.id"
            [tuiDescribedBy]="undoBtn.id"
            [disabled]="undoDisabled"
            [focusable]="false"
            (click)="undo()"
        ></button>
        <button
            #redoBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconRedoLarge"
            class="t-tool t-tool_margin"
            appearance="icon"
            tuiHintDirection="top-left"
            [tuiHint]="texts.redo"
            [tuiHintId]="redoBtn.id"
            [tuiDescribedBy]="redoBtn.id"
            [disabled]="redoDisabled"
            [focusable]="false"
            (click)="redo()"
        ></button>
    </div>
    <div *ngIf="enabled(TuiEditorTool.Size)" class="t-block">
        <tui-hosted-dropdown
            #fonts
            tuiToolbarTool
            class="t-wrapper"
            [content]="fontsDropdown"
        >
            <button
                #button
                #fontsBtn
                tuiIconButton
                type="button"
                size="s"
                appearance="icon"
                class="t-tool"
                icon="tuiIconFontLarge"
                tuiHintDirection="top-left"
                [tuiHint]="texts.font"
                [tuiHintId]="fontsBtn.id"
                [tuiDescribedBy]="fontsBtn.id"
                [pseudoPressed]="fonts.open"
                [focusable]="fonts.open"
            ></button>
            <ng-template #fontsDropdown>
                <tui-data-list #dropdown>
                    <button
                        *ngFor="let item of fontsOptions$ | async"
                        tuiOption
                        [style.fontFamily]="item.family"
                        [style.fontSize.px]="item.px"
                        (click)="onHeading(item)"
                    >
                        {{item.name}}
                    </button>
                </tui-data-list>
            </ng-template>
        </tui-hosted-dropdown>
    </div>
    <div *ngIf="firstBigBlockEnabled" class="t-block">
        <!-- @bad TODO: Keyboard navigation-->
        <tui-hosted-dropdown
            *ngIf="formatEnabled"
            tuiToolbarTool
            #format
            class="t-wrapper"
            [content]="formatDropdown"
        >
            <button
                #button
                #formatBtn
                tuiIconButton
                type="button"
                size="s"
                icon="tuiIconFormatLarge"
                appearance="icon"
                class="t-tool"
                tuiHintDirection="top-left"
                [tuiHint]="texts.fontStyle"
                [tuiHintId]="formatBtn.id"
                [tuiDescribedBy]="formatBtn.id"
                [pseudoPressed]="format.open || bold || italic || underline || strikeThrough"
                [focusable]="format.open"
            ></button>
            <ng-template #formatDropdown>
                <div #dropdown class="t-dropdown">
                    <button
                        *ngIf="enabled(TuiEditorTool.Bold)"
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconBoldLarge"
                        appearance="icon"
                        class="t-tool t-tool_margin"
                        [tuiHint]="texts.bold"
                        [pseudoPressed]="bold"
                        (click)="toggleBold()"
                    ></button>
                    <button
                        *ngIf="enabled(TuiEditorTool.Italic)"
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconItalicLarge"
                        appearance="icon"
                        class="t-tool t-tool_margin"
                        [tuiHint]="texts.italic"
                        [pseudoPressed]="italic"
                        (click)="toggleItalic()"
                    ></button>
                    <button
                        *ngIf="enabled(TuiEditorTool.Underline)"
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconUnderlineLarge"
                        appearance="icon"
                        class="t-tool t-tool_margin"
                        [tuiHint]="texts.underline"
                        [pseudoPressed]="underline"
                        (click)="toggleUnderline()"
                    ></button>
                    <button
                        *ngIf="enabled(TuiEditorTool.Strikethrough)"
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconStrikeThroughLarge"
                        appearance="icon"
                        class="t-tool t-tool_margin"
                        [tuiHint]="texts.strikeThrough"
                        [pseudoPressed]="strikeThrough"
                        (click)="toggleStrikeThrough()"
                    ></button>
                </div>
            </ng-template>
        </tui-hosted-dropdown>
        <!-- @bad TODO: Keyboard navigation-->
        <tui-hosted-dropdown
            *ngIf="enabled(TuiEditorTool.Align)"
            #align
            tuiToolbarTool
            class="t-wrapper"
            [content]="alignDropdown"
        >
            <button
                #button
                #alignBtn
                tuiIconButton
                type="button"
                size="s"
                icon="tuiIconAlignLeftLarge"
                appearance="icon"
                class="t-tool"
                tuiHintDirection="top-left"
                [tuiHint]="texts.justify"
                [tuiHintId]="alignBtn.id"
                [tuiDescribedBy]="alignBtn.id"
                [pseudoPressed]="align.open"
                [focusable]="align.open"
            ></button>
            <ng-template #alignDropdown>
                <div #dropdown class="t-dropdown">
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconAlignLeftLarge"
                        class="t-tool t-tool_margin"
                        appearance="icon"
                        [pseudoPressed]="alignLeft"
                        [tuiHint]="texts.justifyLeft"
                        (click)="onAlign('left')"
                    ></button>
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconAlignCenterLarge"
                        class="t-tool t-tool_margin"
                        appearance="icon"
                        [pseudoPressed]="alignCenter"
                        [tuiHint]="texts.justifyCenter"
                        (click)="onAlign('center')"
                    ></button>
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconAlignRightLarge"
                        class="t-tool t-tool_margin"
                        appearance="icon"
                        [pseudoPressed]="alignRight"
                        [tuiHint]="texts.justifyRight"
                        (click)="onAlign('right')"
                    ></button>
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconAlignJustifyLarge"
                        class="t-tool t-tool_margin"
                        appearance="icon"
                        [pseudoPressed]="justify"
                        [tuiHint]="texts.justifyFull"
                        (click)="onAlign('justify')"
                    ></button>
                </div>
            </ng-template>
        </tui-hosted-dropdown>
        <!-- @bad TODO: Keyboard navigation-->
        <tui-hosted-dropdown
            *ngIf="enabled(TuiEditorTool.List)"
            #list
            tuiToolbarTool
            class="t-wrapper"
            [content]="listDropdown"
        >
            <button
                #button
                #listBtn
                tuiIconButton
                type="button"
                size="s"
                icon="tuiIconViewListLarge"
                class="t-tool"
                appearance="icon"
                tuiHintDirection="top-left"
                [tuiHint]="texts.list"
                [tuiHintId]="listBtn.id"
                [tuiDescribedBy]="listBtn.id"
                [pseudoPressed]="list.open || unorderedList || orderedList"
                [focusable]="list.open"
            ></button>
            <ng-template #listDropdown>
                <div #dropdown class="t-dropdown">
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconViewListLarge"
                        appearance="icon"
                        class="t-tool t-tool_margin"
                        [tuiHint]="texts.unorderedList"
                        [pseudoPressed]="unorderedList"
                        (click)="toggleUnorderedList()"
                    ></button>
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconOLLarge"
                        appearance="icon"
                        class="t-tool t-tool_margin"
                        [tuiHint]="texts.orderedList"
                        [pseudoPressed]="orderedList"
                        (click)="toggleOrderedList()"
                    ></button>
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconIndentLarge"
                        class="t-tool t-tool_margin"
                        appearance="icon"
                        [tuiHint]="texts.indent"
                        (click)="indent()"
                    ></button>
                    <button
                        tuiIconButton
                        type="button"
                        size="s"
                        icon="tuiIconOutdentLarge"
                        class="t-tool t-tool_margin"
                        appearance="icon"
                        [tuiHint]="texts.outdent"
                        (click)="outdent()"
                    ></button>
                </div>
            </ng-template>
        </tui-hosted-dropdown>
        <button
            *ngIf="enabled(TuiEditorTool.Quote)"
            #button
            #quoteBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconQuoteLarge"
            appearance="icon"
            class="t-tool t-tool_margin"
            tuiHintDirection="top-left"
            [tuiHint]="texts.quote"
            [tuiHintId]="quoteBtn.id"
            [tuiDescribedBy]="quoteBtn.id"
            [pseudoPressed]="blockquote"
            [disabled]="unorderedList || orderedList"
            [focusable]="false"
            (click)="toggleQuote()"
        ></button>
        <tui-hosted-dropdown
            *ngIf="enabled(TuiEditorTool.Link)"
            tuiToolbarTool
            #link
            class="t-wrapper"
            [canOpen]="!a"
            [content]="linkDropdown"
        >
            <button
                #button
                #linkBtn
                tuiIconButton
                type="button"
                size="s"
                icon="tuiIconLinkLarge"
                appearance="icon"
                class="t-tool"
                tuiHintDirection="top-left"
                [tuiHint]="texts.link"
                [tuiHintId]="linkBtn.id"
                [tuiDescribedBy]="linkBtn.id"
                [pseudoPressed]="link.open || a"
                [focusable]="link.open"
            ></button>
            <ng-template #linkDropdown>
                <tui-edit-link
                    #dropdown
                    (addLink)="onLink(link, $event)"
                    (removeLink)="onLink(link)"
                ></tui-edit-link>
            </ng-template>
        </tui-hosted-dropdown>
        <button
            *ngIf="enabled(TuiEditorTool.Attach)"
            #button
            #attachBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconAttachLarge"
            class="t-tool t-tool_margin"
            appearance="icon"
            tuiHintDirection="top-left"
            [tuiHint]="texts.attach"
            [tuiHintId]="attachBtn.id"
            [tuiDescribedBy]="attachBtn.id"
            [focusable]="false"
            (click)="onAttach()"
        ></button>
    </div>
    <div
        *ngIf="enabled(TuiEditorTool.Sub) || enabled(TuiEditorTool.Sup)"
        class="t-block"
    >
        <button
            *ngIf="enabled(TuiEditorTool.Sub)"
            #button
            #subBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconSubscriptLarge"
            appearance="icon"
            class="t-tool t-tool_margin"
            tuiHintDirection="top-left"
            [tuiHint]="texts.subscript"
            [tuiHintId]="subBtn.id"
            [tuiDescribedBy]="subBtn.id"
            [pseudoPressed]="subscript"
            [focusable]="false"
            (click)="toggleSubscript()"
        ></button>
        <button
            *ngIf="enabled(TuiEditorTool.Sup)"
            #button
            #supBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconSuperscriptLarge"
            appearance="icon"
            class="t-tool t-tool_margin"
            tuiHintDirection="top-left"
            [tuiHint]="texts.superscript"
            [tuiHintId]="supBtn.id"
            [tuiDescribedBy]="supBtn.id"
            [pseudoPressed]="superscript"
            [focusable]="false"
            (click)="toggleSuperscript()"
        ></button>
    </div>
    <div
        *ngIf="enabled(TuiEditorTool.Color) || enabled(TuiEditorTool.Hilite)"
        class="t-block"
    >
        <!-- TODO: refactor colors -->
        <!-- @bad TODO: Keyboard navigation-->
        <tui-hosted-dropdown
            *ngIf="enabled(TuiEditorTool.Color)"
            #color
            tuiToolbarTool
            class="t-wrapper"
            [content]="colorDropdown"
            [tuiDropdownMaxHeight]="999"
        >
            <button
                #button
                #colorBtn
                tuiIconButton
                type="button"
                size="s"
                icon="tuiIconColorLarge"
                appearance="icon"
                class="t-tool"
                tuiHintDirection="top-left"
                automation-id="toolbar__color-button"
                [tuiHint]="texts.foreColor"
                [tuiHintId]="colorBtn.id"
                [tuiDescribedBy]="colorBtn.id"
                [pseudoPressed]="color.open"
                [focusable]="color.open"
            ></button>
            <div class="t-plate" [style.background]="foreColor"></div>
            <ng-template #colorDropdown let-activeZone>
                <tui-color-selector
                    class="t-color-picker"
                    [tuiActiveZoneParent]="activeZone"
                    [colors]="colors"
                    [color]="foreColor"
                    (colorChange)="setForeColor($event)"
                ></tui-color-selector>
            </ng-template>
        </tui-hosted-dropdown>
        <!-- @bad TODO: Keyboard navigation-->
        <tui-hosted-dropdown
            *ngIf="enabled(TuiEditorTool.Hilite)"
            #hilite
            tuiToolbarTool
            class="t-wrapper"
            [content]="hiliteDropdown"
            [tuiDropdownMaxHeight]="999"
        >
            <button
                #button
                #hiliteBtn
                tuiIconButton
                type="button"
                size="s"
                tuiHintDirection="top-left"
                appearance="icon"
                class="t-tool"
                icon="tuiIconHiliteLarge"
                automation-id="toolbar__hilite-button"
                [tuiHint]="texts.backColor"
                [tuiHintId]="hiliteBtn.id"
                [tuiDescribedBy]="hiliteBtn.id"
                [pseudoPressed]="hilite.open"
                [focusable]="hilite.open"
            ></button>
            <div
                *ngIf="!hiliteColorBlank"
                class="t-plate"
                [style.background]="hiliteColor"
            ></div>
            <ng-template #hiliteDropdown let-activeZone>
                <tui-color-selector
                    class="t-color-picker"
                    [tuiActiveZoneParent]="activeZone"
                    [colors]="colors"
                    [color]="hiliteColor"
                    (colorChange)="setHiliteColor($event)"
                ></tui-color-selector>
            </ng-template>
        </tui-hosted-dropdown>
    </div>
    <div *ngIf="secondBigBlockEnabled" class="t-block">
        <tui-hosted-dropdown
            *ngIf="enabled(TuiEditorTool.Code)"
            #codes
            tuiToolbarTool
            class="t-wrapper"
            [content]="codesDropdown"
        >
            <button
                #button
                #codeBtn
                tuiIconButton
                type="button"
                size="s"
                icon="tuiIconCodeLarge"
                appearance="icon"
                class="t-tool"
                tuiHintDirection="top-left"
                [tuiHint]="texts.code"
                [tuiHintId]="codeBtn.id"
                [tuiDescribedBy]="codeBtn.id"
                [pseudoPressed]="codes.open || code || pre"
                [focusable]="codes.open"
            ></button>
            <ng-template #codesDropdown>
                <tui-data-list #dropdown>
                    <button
                        *ngFor="let item of codeOptionsTexts$ | async; let index = index"
                        tuiOption
                        (click)="onCode(index)"
                    >
                        {{item}}
                    </button>
                </tui-data-list>
            </ng-template>
        </tui-hosted-dropdown>
        <button
            *ngIf="enabled(TuiEditorTool.Tex)"
            #button
            #texBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconTeXLarge"
            class="t-tool"
            appearance="icon"
            tuiHintDirection="top-left"
            [tuiHint]="texts.tex"
            [tuiHintId]="texBtn.id"
            [tuiDescribedBy]="texBtn.id"
            [focusable]="false"
            (click)="onTeX()"
        ></button>
        <div *ngIf="enabled(TuiEditorTool.Img)" class="t-wrapper">
            <input
                #image
                class="t-image"
                type="file"
                accept="image/*"
                [tuiFocusable]="false"
                (change)="onImage(image)"
            />
            <button
                #button
                tuiIconButton
                tuiToolbarTool
                type="button"
                size="s"
                icon="tuiIconImgLarge"
                class="t-tool"
                appearance="icon"
                tuiHintDirection="top-left"
                [tuiHint]="texts.image"
                [id]="button.id"
                [tuiHintId]="button.id"
                [focusable]="false"
                (click)="image.click()"
            ></button>
        </div>
        <button
            *ngIf="enabled(TuiEditorTool.HR)"
            #button
            #hrBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconHrLarge"
            class="t-tool t-tool_margin"
            appearance="icon"
            tuiHintDirection="top-left"
            [tuiHint]="texts.insertHorizontalRule"
            [tuiHintId]="hrBtn.id"
            [tuiDescribedBy]="hrBtn.id"
            [focusable]="false"
            (click)="insertHorizontalRule()"
        ></button>
    </div>
    <div *ngIf="enabled(TuiEditorTool.Clear)" class="t-block">
        <button
            #button
            #clearBtn
            tuiIconButton
            tuiToolbarTool
            type="button"
            size="s"
            icon="tuiIconClearFormatLarge"
            class="t-tool t-tool_margin"
            appearance="icon"
            tuiHintDirection="top-left"
            [tuiHint]="texts.clear"
            [tuiHintId]="clearBtn.id"
            [tuiDescribedBy]="clearBtn.id"
            [focusable]="false"
            (click)="removeFormat()"
        ></button>
    </div>
    <div *ngIf="enabled(TuiEditorTool.Table)" class="t-block">
        <tui-table-create
            tuiToolbarTool
            class="t-tool t-tool_margin"
        ></tui-table-create>

        <tui-table-row-column-manager
            tuiToolbarTool
            class="t-tool t-tool_margin"
        ></tui-table-row-column-manager>

        <tui-table-merge-cells
            tuiToolbarTool
            class="t-tool t-tool_margin"
        ></tui-table-merge-cells>

        <tui-table-cell-color
            tuiToolbarTool
            class="t-tool t-wrapper"
            [colors]="colors"
        ></tui-table-cell-color>
    </div>
    <div class="t-block">
        <ng-content></ng-content>
    </div>
</section>
