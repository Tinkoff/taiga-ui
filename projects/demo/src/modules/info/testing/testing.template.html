<tui-doc-page i18n-header header="Testing">
    <h1 i18n class="tui-text_h4 tui-space_top-0 tui-space_bottom-3">
        Tips for integration tests
    </h1>
    <p>
        Some tips to increase you dev experience while testing your app with
        Taiga UI components.
    </p>

    <ul class="steps tips__navigation">
        <li>
            <a tuiLink routerLink="." fragment="disable-animation" i18n
                >Disable all animation</a
            >
        </li>
        <li>
            <a tuiLink routerLink="." fragment="screenshot-bot" i18n
                >Use our Github App "Argus"</a
            >
        </li>
    </ul>

    <ol class="steps tips__content">
        <li id="disable-animation" i18n class="tui-space_bottom-10">
            <strong>Disable animation in all Taiga UI components</strong>

            <p>
                While integration testing you can face with problem of flaky
                tests caused by animation. It is especially crucial if you are
                writing screenshot tests.
            </p>

            <p>
                For example, you want to make screenshot of dialog content: you
                click button which opens dialog and make screenshot. Sometimes
                screenshots can be made too early (before dialog fully opens)
                and test fails.
            </p>

            <p>
                To avoid this
                <strong
                    >we recommend to toggle all animation off while integration
                    test.</strong
                >
            </p>

            <p>
                For example, we use
                <a tuiLink target="_blank" href="https://www.cypress.io/"
                    >Cypress</a
                >
                for screenshot testing of our ui-kit component.
            </p>
            <ol class="tui-list">
                <li class="tui-list__item">
                    To detect if app is running under Cypress we use token
                    <code>TUI_IS_CYPRESS</code>.
                </li>
                <li class="tui-list__item">
                    To disable animation in ALL Taiga UI component we use token
                    <code>TUI_ANIMATIONS_DURATION</code>.
                </li>
            </ol>

            <tui-doc-code
                filename="app.module.ts"
                [code]="disableAnimationExample"
            ></tui-doc-code>
        </li>

        <li id="screenshot-bot">
            <strong
                >Use our
                <a
                    tuiLink
                    target="_blank"
                    href="https://github.com/apps/argus-bot"
                    >Github App Argus</a
                ></strong
            >

            <p>
                Using official Cypress dashboard is rather expensive (especially
                if you run thousands of tests every day). What's why we
                developed Github App. This bot:
            </p>

            <ul class="tui-list">
                <li class="tui-list__item">
                    Downloads artifacts from workflow with tests, finds
                    screenshots diffs images, and pins them to the tests failure
                    report as Pull Request comment.
                </li>
                <li class="tui-list__item">
                    Always holds first PR comment. Any workflow updates (for
                    example, new commit pushed to the branch) edit already
                    existing bot comment. No endless stream of comments from
                    bot!
                </li>
                <li class="tui-list__item">
                    Doesn't require any data-storage for your screenshots with
                    diffs. Bot creates separate branch to upload images for its
                    tests failure report. After closing PR bot removes all saved
                    screenshots. Also, you can delete this branch at any time to
                    clean github history.
                </li>
            </ul>

            <ol class="steps">
                To begin using
                <strong>Argus bot</strong
                >:

                <li>
                    <a
                        tuiLink
                        target="_blank"
                        href="https://github.com/apps/argus-bot/installations/new"
                        >Invite him</a
                    >
                    to you repo.
                </li>
                <li>
                    See its configurable params
                    <a
                        tuiLink
                        target="_blank"
                        href="https://github.com/TinkoffCreditSystems/argus"
                        >in its repo's README</a
                    >
                    or use default ones.
                </li>
            </ol>
        </li>
    </ol>
</tui-doc-page>
